name: helm-lint-ct
description: Helm lint + chart-testing lint/install
inputs:
  helm-version:
    required: true
  chart-path:
    default: helm/mcp-operator
  ct-target-branch:
    default: main
  run-install:
    default: "true"
runs:
  using: composite
  steps:
    - uses: actions/checkout@08eba0b27e820071cde6df949e0beb9ba4906955 # v4
    - uses: azure/setup-helm@1a275c3b69536ee54be43f2070a358922e12c8d4 # v4
      with:
        version: ${{ inputs.helm-version }}
    - shell: bash
      run: |
        if [ -d "${{ inputs.chart-path }}" ]; then
          helm dependency update "${{ inputs.chart-path }}" || true
          helm lint "${{ inputs.chart-path }}"
        else
          echo "Chart not found at ${{ inputs.chart-path }} â€” skipping helm lint."
        fi
    - uses: actions/setup-python@a26af69be951a213d495a4c3e4e4022e16d87065 # v5
      with:
        python-version: '3.x'
    - uses: helm/chart-testing-action@6ec842c01de15ebb84c8627d2744a0c2f2755c9f # v2.8.0
    - shell: bash
      run: |
        if [ -d "helm" ]; then
          ct lint --target-branch "${{ inputs.ct-target-branch }}" || true
        fi
    - if: ${{ inputs.run-install == 'true' }}
      uses: helm/kind-action@92086f6be054225fa813e0a4b13787fc9088faab # v1.13.0
      with:
        wait: 300s
    - if: ${{ inputs.run-install == 'true' }}
      shell: bash
      run: ct install --target-branch "${{ inputs.ct-target-branch }}"
